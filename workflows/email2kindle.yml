on:
  script:
    run: |
      return Date.now()
jobs:
  convert_via_pandoc:
    runs-on: ubuntu-latest
    steps:
      - name: Get UnRead Email
        uses: muxueqz/getemail-action@main
        with:
          email_server: outlook.office365.com
          email_user: ${{secrets.EMAIL_USER}}
          email_password: ${{secrets.EMAIL_PASSWORD}}
          output_file: './outputs/'
      - name: Convert via Pandoc
        # uses: maxheld83/pandoc@v2
        uses: docker://pandoc/core:latest
        with:
          args: 'for i in ./outputs/*.html;do pandoc --output="$i.docx" "$i"'
      - name: Print Pandoc Outputs
        # run: wc -c index.docx
        run: wc -c "${{(on.email.outputs.subject)}}.docx"
      - name: Send mail by action-send-mail
        # uses: muxueqz/action-send-mail@v3.0.4
        uses: dawidd6/action-send-mail@v2
        with:
          server_address: outlook.office365.com
          server_port: 587
          username: ${{secrets.EMAIL_USER}}
          password: ${{secrets.EMAIL_PASSWORD}}
          subject: ${{(on.email.outputs.subject)}}
          body: Build job of ${{github.repository}} completed successfully!
          to: ${{secrets.TO_EMAIL}}
          from: actionsworkflow # <user@example.com>
          attachments: "${{(on.email.outputs.subject)}}.docx"
      - name: Set Read Email
        uses: docker://muxueqz/getemail-action:latest
        with:
          args: "python mark_unread.py"
